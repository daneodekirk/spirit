function MediumEditor(a,b){"use strict";return this.init(a,b)}!function(a){function b(){}jQuery.event.props.push("dataTransfer");var c={fallback_id:"",url:"",refresh:1e3,paramname:"userfile",requestType:"POST",allowedfileextensions:[],allowedfiletypes:[],maxfiles:25,maxfilesize:1,queuefiles:0,queuewait:200,data:{},headers:{},drop:b,dragStart:b,dragEnter:b,dragOver:b,dragLeave:b,docEnter:b,docOver:b,docLeave:b,beforeEach:b,afterAll:b,rename:b,error:function(a){alert(a)},uploadStarted:b,uploadFinished:b,progressUpdated:b,globalProgressUpdated:b,speedUpdated:b},d=["BrowserNotSupported","TooManyFiles","FileTooLarge","FileTypeNotAllowed","NotFound","NotReadable","AbortError","ReadError","FileExtensionNotAllowed"];a.fn.filedrop=function(b){function e(a){if(w.drop.call(this,a)===!1)return!1;if(a.dataTransfer)return v=a.dataTransfer.files,null===v||void 0===v||0===v.length?(w.error(d[0]),!1):(z=v.length,i(),a.preventDefault(),!1)}function f(b,c,d,e){var f="--",g="\r\n",h="",i=w.paramname;if(w.data){var j=a.param(w.data).replace(/\+/g,"%20").split(/&/);a.each(j,function(){var a=this.split("=",2),b=decodeURIComponent(a[0]),c=decodeURIComponent(a[1]);2===a.length&&(h+=f,h+=e,h+=g,h+='Content-Disposition: form-data; name="'+b+'"',h+=g,h+=g,h+=c,h+=g)})}return jQuery.isFunction(i)&&(i=i(b)),h+=f,h+=e,h+=g,h+='Content-Disposition: form-data; name="'+(i||"")+'"',h+='; filename="'+b+'"',h+=g,h+="Content-Type: "+d,h+=g,h+=g,h+=c,h+=g,h+=f,h+=e,h+=f,h+=g}function g(a){if(a.lengthComputable){var b=Math.round(100*a.loaded/a.total);if(this.currentProgress!==b){this.currentProgress=b,w.progressUpdated(this.index,this.file,this.currentProgress),x[this.global_progress_index]=this.currentProgress,h();var c=(new Date).getTime(),d=c-this.currentStart;if(d>=w.refresh){var e=a.loaded-this.startData,f=e/d;w.speedUpdated(this.index,this.file,f),this.startData=a.loaded,this.currentStart=c}}}}function h(){if(0!==x.length){var a,b=0;for(a in x)x.hasOwnProperty(a)&&(b+=x[a]);w.globalProgressUpdated(Math.round(b/x.length))}}function i(){if(y=!1,!v)return w.error(d[0]),!1;if(w.allowedfiletypes.push&&w.allowedfiletypes.length)for(var b=v.length;b--;)if(!v[b].type||a.inArray(v[b].type,w.allowedfiletypes)<0)return w.error(d[3],v[b]),!1;if(w.allowedfileextensions.push&&w.allowedfileextensions.length)for(var b=v.length;b--;){var c=!1;for(q=0;q<w.allowedfileextensions.length;q++)v[b].name.substr(v[b].name.length-w.allowedfileextensions[q].length)==w.allowedfileextensions[q]&&(c=!0);if(!c)return w.error(d[8],v[b]),!1}var e=0,i=0;if(z>w.maxfiles&&0===w.queuefiles)return w.error(d[1]),!1;for(var n=[],o=[],p=[],q=0;z>q;q++)n.push(q);var r=function(a){setTimeout(s,a)},s=function(){var a;if(y)return!1;if(w.queuefiles>0&&o.length>=w.queuefiles)return r(w.queuewait);a=n[0],n.splice(0,1),o.push(a);try{if(l(v[a])!==!1){if(a===z)return;var b=new FileReader,c=1048576*w.maxfilesize;if(b.index=a,v[a].size>c)return w.error(d[2],v[a],a),o.forEach(function(b,c){b===a&&o.splice(c,1)}),i++,!0;b.onerror=function(a){switch(a.target.error.code){case a.target.error.NOT_FOUND_ERR:return w.error(d[4]),!1;case a.target.error.NOT_READABLE_ERR:return w.error(d[5]),!1;case a.target.error.ABORT_ERR:return w.error(d[6]),!1;default:return w.error(d[7]),!1}},b.onloadend=w.beforeSend?function(b){w.beforeSend(v[a],a,function(){t(b)})}:t,b.readAsDataURL(v[a])}else i++}catch(e){return o.forEach(function(b,c){b===a&&o.splice(c,1)}),w.error(d[0]),!1}n.length>0&&s()},t=function(b){var c=(b.srcElement||b.target).index;void 0===b.target.index&&(b.target.index=j(b.total));var d,l=new XMLHttpRequest,n=l.upload,q=v[b.target.index],r=b.target.index,s=(new Date).getTime(),t="------multipartformboundary"+(new Date).getTime(),u=x.length,A=k(q.name),B=q.type;w.withCredentials&&(l.withCredentials=w.withCredentials);var C=atob(b.target.result.split(",")[1]);d="string"==typeof A?f(A,C,B,t):f(q.name,C,B,t),n.index=r,n.file=q,n.downloadStartTime=s,n.currentStart=s,n.currentProgress=0,n.global_progress_index=u,n.startData=0,n.addEventListener("progress",g,!1),jQuery.isFunction(w.url)?l.open(w.requestType,w.url(),!0):l.open(w.requestType,w.url,!0),l.setRequestHeader("content-type","multipart/form-data; boundary="+t),l.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.each(w.headers,function(a,b){l.setRequestHeader(a,b)}),l.sendAsBinary(d),x[u]=0,h(),w.uploadStarted(r,q,z),l.onload=function(){var a=null;if(l.responseText)try{a=jQuery.parseJSON(l.responseText)}catch(b){a=l.responseText}var d=(new Date).getTime(),f=d-s,g=w.uploadFinished(r,q,a,f,l);e++,o.forEach(function(a,b){a===c&&o.splice(b,1)}),p.push(c),x[u]=100,h(),e===z-i&&m(),g===!1&&(y=!0),(l.status<200||l.status>299)&&w.error(l.statusText,q,c,l.status)}};s()}function j(a){for(var b=0;z>b;b++)if(v[b].size===a)return b;return void 0}function k(a){return w.rename(a)}function l(a){return w.beforeEach(a)}function m(){return w.afterAll()}function n(a){clearTimeout(u),a.preventDefault(),w.dragEnter.call(this,a)}function o(a){clearTimeout(u),a.preventDefault(),w.docOver.call(this,a),w.dragOver.call(this,a)}function p(a){clearTimeout(u),w.dragLeave.call(this,a),a.stopPropagation()}function q(a){return a.preventDefault(),w.docLeave.call(this,a),!1}function r(a){return clearTimeout(u),a.preventDefault(),w.docEnter.call(this,a),!1}function s(a){return clearTimeout(u),a.preventDefault(),w.docOver.call(this,a),!1}function t(a){u=setTimeout(function(b){return function(){w.docLeave.call(b,a)}}(this),200)}var u,v,w=a.extend({},c,b),x=[],y=!1,z=0;return a("#"+w.fallback_id).css({display:"none",width:0,height:0}),this.on("drop",e).on("dragstart",w.dragStart).on("dragenter",n).on("dragover",o).on("dragleave",p),a(document).on("drop",q).on("dragenter",r).on("dragover",s).on("dragleave",t),this.on("click",function(b){a("#"+w.fallback_id).trigger(b)}),a("#"+w.fallback_id).change(function(a){w.drop(a),v=a.target.files,z=v.length,i()}),this};try{if(XMLHttpRequest.prototype.sendAsBinary)return;XMLHttpRequest.prototype.sendAsBinary=function(a){function b(a){return 255&a.charCodeAt(0)}var c=Array.prototype.map.call(a,b),d=new Uint8Array(c);this.send("ArrayBufferView"in window?d:d.buffer)}}catch(e){}}(jQuery),function(a){"use strict";a.fn.serializeJSON=function(){var b,c;return b={},c=this.serializeArray(),a.each(c,function(c,d){var e,f,g;e=d.name,f=d.value,g=a.map(e.split("["),function(a){var b;return b=a[a.length-1],"]"===b?a.substring(0,a.length-1):a}),""===g[0]&&g.shift(),a.deepSet(b,g,f)}),b};var b=function(a){return a===Object(a)};a.deepSet=function(c,d,e){if(!d||0===d.length)throw new Error("ArgumentError: keys param expected to be an array with least one key");var f,g,h,i,j,k;f=d[0],g=d[1],void 0!==g&&null!==g?(h=d.slice(1),""===f&&(j=c.length-1,k=c[c.length-1],b(k)&&!k[g]?f=j:(c.push({}),f=j+1)),void 0===c[f]&&(i=""!==g&&isNaN(parseInt(g,10))?{}:[],c[f]=i),a.deepSet(c[f],h,e)):""===f?c.push(e):c[f]=e}}(jQuery),"object"==typeof module&&(module.exports=MediumEditor),function(a,b){"use strict";function c(a,b){var c;if(void 0===a)return b;for(c in b)b.hasOwnProperty(c)&&a.hasOwnProperty(c)===!1&&(a[c]=b[c]);return a}function d(){var b,c,d,e=a.getSelection();if(e.getRangeAt&&e.rangeCount){for(d=[],b=0,c=e.rangeCount;c>b;b+=1)d.push(e.getRangeAt(b));return d}return null}function e(b){var c,d,e=a.getSelection();if(b)for(e.removeAllRanges(),c=0,d=b.length;d>c;c+=1)e.addRange(b[c])}function f(){var a=b.getSelection().anchorNode,c=a&&3===a.nodeType?a.parentNode:a;return c}function g(){var c,d,e,f,g="";if(void 0!==a.getSelection){if(d=a.getSelection(),d.rangeCount){for(f=b.createElement("div"),c=0,e=d.rangeCount;e>c;c+=1)f.appendChild(d.getRangeAt(c).cloneContents());g=f.innerHTML}}else void 0!==b.selection&&"Text"===b.selection.type&&(g=b.selection.createRange().htmlText);return g}MediumEditor.prototype={defaults:{allowMultiParagraphSelection:!0,anchorInputPlaceholder:"Paste or type a link",buttons:["bold","italic","underline","anchor","header1","header2","quote"],buttonLabels:!1,delay:0,diffLeft:0,diffTop:-10,disableReturn:!1,disableToolbar:!1,firstHeader:"h3",forcePlainText:!0,placeholder:"Type your text",secondHeader:"h4",targetBlank:!1},init:function(a,d){return this.elements="string"==typeof a?b.querySelectorAll(a):a,0!==this.elements.length?(this.isActive=!0,this.parentElements=["p","h1","h2","h3","h4","h5","h6","blockquote","pre"],this.id=b.querySelectorAll(".medium-editor-toolbar").length+1,this.options=c(d,this.defaults),this.initElements().bindSelect().bindPaste().setPlaceholders().bindWindowActions()):void 0},initElements:function(){var a,b=!1;for(a=0;a<this.elements.length;a+=1)this.elements[a].setAttribute("contentEditable",!0),this.elements[a].getAttribute("data-placeholder")||this.elements[a].setAttribute("data-placeholder",this.options.placeholder),this.elements[a].setAttribute("data-medium-element",!0),this.bindParagraphCreation(a).bindReturn(a).bindTab(a),this.options.disableToolbar||this.elements[a].getAttribute("data-disable-toolbar")||(b=!0);return b&&this.initToolbar().bindButtons().bindAnchorForm(),this},serialize:function(){var a,b,c={};for(a=0;a<this.elements.length;a+=1)b=""!==this.elements[a].id?this.elements[a].id:"element-"+a,c[b]={value:this.elements[a].innerHTML.trim()};return c},bindParagraphCreation:function(a){var c=this;return this.elements[a].addEventListener("keyup",function(a){var d,e=f();e&&e.getAttribute("data-medium-element")&&0===e.children.length&&!c.options.disableReturn&&!e.getAttribute("data-disable-return")&&b.execCommand("formatBlock",!1,"p"),13!==a.which||a.shiftKey||(e=f(),d=e.tagName.toLowerCase(),c.options.disableReturn||this.getAttribute("data-disable-return")||"li"===d||(b.execCommand("formatBlock",!1,"p"),"a"===d&&b.execCommand("unlink",!1,null)))}),this},bindReturn:function(a){var b=this;return this.elements[a].addEventListener("keypress",function(a){13===a.which&&(b.options.disableReturn||this.getAttribute("data-disable-return"))&&a.preventDefault()}),this},bindTab:function(a){this.elements[a].addEventListener("keydown",function(a){if(9===a.which){var c=f().tagName.toLowerCase();"pre"===c&&(a.preventDefault(),b.execCommand("insertHtml",null,"    "))}})},buttonTemplate:function(a){var b=this.getButtonLabels(this.options.buttonLabels),c={bold:'<li><button class="medium-editor-action medium-editor-action-bold" data-action="bold" data-element="b">'+b.bold+"</button></li>",italic:'<li><button class="medium-editor-action medium-editor-action-italic" data-action="italic" data-element="i">'+b.italic+"</button></li>",underline:'<li><button class="medium-editor-action medium-editor-action-underline" data-action="underline" data-element="u">'+b.underline+"</button></li>",strikethrough:'<li><button class="medium-editor-action medium-editor-action-strikethrough" data-action="strikethrough" data-element="strike"><strike>A</strike></button></li>',superscript:'<li><button class="medium-editor-action medium-editor-action-superscript" data-action="superscript" data-element="sup">'+b.superscript+"</button></li>",subscript:'<li><button class="medium-editor-action medium-editor-action-subscript" data-action="subscript" data-element="sub">'+b.subscript+"</button></li>",anchor:'<li><button class="medium-editor-action medium-editor-action-anchor" data-action="anchor" data-element="a">'+b.anchor+"</button></li>",header1:'<li><button class="medium-editor-action medium-editor-action-header1" data-action="append-'+this.options.firstHeader+'" data-element="'+this.options.firstHeader+'">'+b.header1+"</button></li>",header2:'<li><button class="medium-editor-action medium-editor-action-header2" data-action="append-'+this.options.secondHeader+'" data-element="'+this.options.secondHeader+'">'+b.header2+"</button></li>",quote:'<li><button class="medium-editor-action medium-editor-action-quote" data-action="append-blockquote" data-element="blockquote">'+b.quote+"</button></li>",orderedlist:'<li><button class="medium-editor-action medium-editor-action-orderedlist" data-action="insertorderedlist" data-element="ol">'+b.orderedlist+"</button></li>",unorderedlist:'<li><button class="medium-editor-action medium-editor-action-unorderedlist" data-action="insertunorderedlist" data-element="ul">'+b.unorderedlist+"</button></li>",pre:'<li><button class="medium-editor-action medium-editor-action-pre" data-action="append-pre" data-element="pre">'+b.pre+"</button></li>"};return c[a]||!1},getButtonLabels:function(a){var b,c,d={bold:"<b>B</b>",italic:"<b><i>I<i></b>",underline:"<b><u>U</u></b>",superscript:"<b>x<sup>1</sup></b>",subscript:"<b>x<sub>1</sup></b>",anchor:"<b>#</b>",header1:"<b>H1</b>",header2:"<b>H2</b>",quote:"<b>&ldquo;</b>",orderedlist:"<b>1.</b>",unorderedlist:"<b>&bull;</b>",pre:"<b>0101</b>"};if("fontawesome"===a?b={bold:'<i class="fa fa-bold"></i>',italic:'<i class="fa fa-italic"></i>',underline:'<i class="fa fa-underline"></i>',superscript:'<i class="fa fa-superscript"></i>',subscript:'<i class="fa fa-subscript"></i>',anchor:'<i class="fa fa-link"></i>',quote:'<i class="fa fa-quote-right"></i>',orderedlist:'<i class="fa fa-list-ol"></i>',unorderedlist:'<i class="fa fa-list-ul"></i>',pre:'<i class="fa fa-code fa-lg"></i>'}:"object"==typeof a&&(b=a),"object"==typeof b)for(c in b)b.hasOwnProperty(c)&&(d[c]=b[c]);return d},toolbarTemplate:function(){var a,b,c=this.options.buttons,d='<ul id="medium-editor-toolbar-actions" class="medium-editor-toolbar-actions clearfix">';for(a=0;a<c.length;a+=1)b=this.buttonTemplate(c[a]),b&&(d+=b);return d+='</ul><div class="medium-editor-toolbar-form-anchor" id="medium-editor-toolbar-form-anchor">    <input type="text" value="" placeholder="'+this.options.anchorInputPlaceholder+'">    <a href="#">&times;</a></div>'},initToolbar:function(){return this.toolbar?this:(this.toolbar=this.createToolbar(),this.keepToolbarAlive=!1,this.anchorForm=this.toolbar.querySelector(".medium-editor-toolbar-form-anchor"),this.anchorInput=this.anchorForm.querySelector("input"),this.toolbarActions=this.toolbar.querySelector(".medium-editor-toolbar-actions"),this)},createToolbar:function(){var a=b.createElement("div");return a.id="medium-editor-toolbar-"+this.id,a.className="medium-editor-toolbar",a.innerHTML=this.toolbarTemplate(),b.getElementsByTagName("body")[0].appendChild(a),a},bindSelect:function(){var a,c=this,d="";for(this.checkSelectionWrapper=function(){clearTimeout(d),d=setTimeout(function(){c.checkSelection()},c.options.delay)},b.documentElement.addEventListener("mouseup",this.checkSelectionWrapper),a=0;a<this.elements.length;a+=1)this.elements[a].addEventListener("keyup",this.checkSelectionWrapper),this.elements[a].addEventListener("blur",this.checkSelectionWrapper);return this},checkSelection:function(){var b,c,d,e,f;if(this.keepToolbarAlive!==!0&&!this.options.disableToolbar)if(c=a.getSelection(),e=g(),e=e.replace(/<[\S]+><\/[\S]+>/gim,""),d=e.match(/<(p|h[0-6]|blockquote)>([\s\S]*?)<\/(p|h[0-6]|blockquote)>/g),d=d?d.length:0,""===c.toString().trim()||this.options.allowMultiParagraphSelection===!1&&d)this.hideToolbarActions();else if(f=this.getSelectionElement(),!f||f.getAttribute("data-disable-toolbar"))this.hideToolbarActions();else{for(this.selection=c,this.selectionRange=this.selection.getRangeAt(0),b=0;b<this.elements.length;b+=1)if(this.elements[b]===f)return void this.setToolbarButtonStates().setToolbarPosition().showToolbarActions();this.hideToolbarActions()}return this},getSelectionElement:function(){var b,c=a.getSelection(),d=c.getRangeAt(0),e=d.commonAncestorContainer,f=e.parentNode,g=function(a){var b=a;try{for(;!b.getAttribute("data-medium-element");)b=b.parentNode}catch(c){return!1}return b};try{b=e.getAttribute("data-medium-element")?e:g(f)}catch(h){b=g(f)}return b},setToolbarPosition:function(){var b=50,c=a.getSelection(),d=c.getRangeAt(0),e=d.getBoundingClientRect(),f=this.options.diffLeft-this.toolbar.offsetWidth/2,g=(e.left+e.right)/2,h=this.toolbar.offsetWidth/2;return e.top<b?(this.toolbar.classList.add("medium-toolbar-arrow-over"),this.toolbar.classList.remove("medium-toolbar-arrow-under"),this.toolbar.style.top=b+e.bottom-this.options.diffTop+a.pageYOffset-this.toolbar.offsetHeight+"px"):(this.toolbar.classList.add("medium-toolbar-arrow-under"),this.toolbar.classList.remove("medium-toolbar-arrow-over"),this.toolbar.style.top=e.top+this.options.diffTop+a.pageYOffset-this.toolbar.offsetHeight+"px"),this.toolbar.style.left=h>g?f+h+"px":a.innerWidth-g<h?a.innerWidth+f-h+"px":f+g+"px",this},setToolbarButtonStates:function(){var a,b=this.toolbarActions.querySelectorAll("button");for(a=0;a<b.length;a+=1)b[a].classList.remove("medium-editor-button-active");return this.checkActiveButtons(),this},checkActiveButtons:function(){var a=this.selection.anchorNode;for(a.tagName||(a=this.selection.anchorNode.parentNode);void 0!==a.tagName&&-1===this.parentElements.indexOf(a.tagName);)this.activateButton(a.tagName.toLowerCase()),a=a.parentNode},activateButton:function(a){var b=this.toolbar.querySelector('[data-element="'+a+'"]');null!==b&&-1===b.className.indexOf("medium-editor-button-active")&&(b.className+=" medium-editor-button-active")},bindButtons:function(){var a,b=this.toolbar.querySelectorAll("button"),c=this,d=function(a){a.preventDefault(),a.stopPropagation(),void 0===c.selection&&c.checkSelection(),this.className.indexOf("medium-editor-button-active")>-1?this.classList.remove("medium-editor-button-active"):this.className+=" medium-editor-button-active",console.log(this.getAttribute("data-action")),c.execAction(this.getAttribute("data-action"),a)};for(a=0;a<b.length;a+=1)b[a].addEventListener("click",d);return this.setFirstAndLastItems(b),this},setFirstAndLastItems:function(a){return a[0].className+=" medium-editor-button-first",a[a.length-1].className+=" medium-editor-button-last",this},execAction:function(a,c){a.indexOf("append-")>-1?(this.execFormatBlock(a.replace("append-","")),this.setToolbarPosition(),this.setToolbarButtonStates()):"anchor"===a?this.triggerAnchorAction(c):(b.execCommand(a,!1,null),this.setToolbarPosition())},triggerAnchorAction:function(){return"a"===this.selection.anchorNode.parentNode.tagName.toLowerCase()?b.execCommand("unlink",!1,null):"block"===this.anchorForm.style.display?this.showToolbarActions():this.showAnchorForm(),this},execFormatBlock:function(a){var c=this.getSelectionData(this.selection.anchorNode);return"blockquote"===a&&c.el&&"blockquote"===c.el.parentNode.tagName.toLowerCase()?b.execCommand("outdent",!1,null):(c.tagName===a&&(a="p"),b.execCommand("formatBlock",!1,a))},getSelectionData:function(a){var b;for(a&&a.tagName&&(b=a.tagName.toLowerCase());a&&-1===this.parentElements.indexOf(b);)a=a.parentNode,a&&a.tagName&&(b=a.tagName.toLowerCase());return{el:a,tagName:b}},getFirstChild:function(a){for(var b=a.firstChild;null!==b&&1!==b.nodeType;)b=b.nextSibling;return b},bindElementToolbarEvents:function(a){var b=this;a.addEventListener("mouseup",function(){b.checkSelection()}),a.addEventListener("keyup",function(){b.checkSelection()})},hideToolbarActions:function(){this.keepToolbarAlive=!1,this.toolbar.classList.remove("medium-editor-toolbar-active")},showToolbarActions:function(){var a,b=this;this.anchorForm.style.display="none",this.toolbarActions.style.display="block",this.keepToolbarAlive=!1,clearTimeout(a),a=setTimeout(function(){b.toolbar.classList.contains("medium-editor-toolbar-active")||b.toolbar.classList.add("medium-editor-toolbar-active")},100)},showAnchorForm:function(){this.toolbarActions.style.display="none",this.savedSelection=d(),this.anchorForm.style.display="block",this.keepToolbarAlive=!0,this.anchorInput.focus(),this.anchorInput.value=""},bindAnchorForm:function(){var a=this.anchorForm.querySelector("a"),b=this;return this.anchorForm.addEventListener("click",function(a){a.stopPropagation()}),this.anchorInput.addEventListener("keyup",function(a){13===a.keyCode&&(a.preventDefault(),b.createLink(this))}),this.anchorInput.addEventListener("blur",function(){b.keepToolbarAlive=!1,b.checkSelection()}),a.addEventListener("click",function(a){a.preventDefault(),b.showToolbarActions(),e(b.savedSelection)}),this},setTargetBlank:function(){var a,b=f();if("a"===b.tagName.toLowerCase())b.target="_blank";else for(b=b.getElementsByTagName("a"),a=0;a<b.length;a+=1)b[a].target="_blank"},createLink:function(a){e(this.savedSelection),b.execCommand("createLink",!1,a.value),this.options.targetBlank&&this.setTargetBlank(),this.showToolbarActions(),a.value=""},bindWindowActions:function(){var b,c=this;return a.addEventListener("resize",function(){clearTimeout(b),b=setTimeout(function(){c.toolbar.classList.contains("medium-editor-toolbar-active")&&c.setToolbarPosition()},100)}),this},activate:function(){var a;if(!this.isActive){for(void 0!==this.toolbar&&(this.toolbar.style.display="block"),this.isActive=!0,a=0;a<this.elements.length;a+=1)this.elements[a].setAttribute("contentEditable",!0);this.bindSelect()}},deactivate:function(){var a;if(this.isActive)for(this.isActive=!1,void 0!==this.toolbar&&(this.toolbar.style.display="none"),b.documentElement.removeEventListener("mouseup",this.checkSelectionWrapper),a=0;a<this.elements.length;a+=1)this.elements[a].removeEventListener("keyup",this.checkSelectionWrapper),this.elements[a].removeEventListener("blur",this.checkSelectionWrapper),this.elements[a].removeAttribute("contentEditable")},bindPaste:function(){if(!this.options.forcePlainText)return this;var a,c=this,d=function(a){var d,e,f="";if(this.classList.remove("medium-editor-placeholder"),a.clipboardData&&a.clipboardData.getData)if(a.preventDefault(),c.options.disableReturn)b.execCommand("insertHTML",!1,a.clipboardData.getData("text/plain"));else{for(d=a.clipboardData.getData("text/plain").split(/[\r\n]/g),e=0;e<d.length;e+=1)""!==d[e]&&(f+="<p>"+d[e]+"</p>");b.execCommand("insertHTML",!1,f)}};for(a=0;a<this.elements.length;a+=1)this.elements[a].addEventListener("paste",d);return this},setPlaceholders:function(){var a,b=function(a){""===a.textContent.replace(/^\s+|\s+$/g,"")&&a.classList.add("medium-editor-placeholder")},c=function(a){this.classList.remove("medium-editor-placeholder"),"keypress"!==a.type&&b(this)};for(a=0;a<this.elements.length;a+=1)b(this.elements[a]),this.elements[a].addEventListener("blur",c),this.elements[a].addEventListener("keypress",c);return this}}}(window,document),function(a){MediumEditor.prototype.serialize=function(){var b,c,d,e,f,g,h,i,j={};for(b=0;b<this.elements.length;b+=1){for(d=""!==this.elements[b].id?this.elements[b].id:"element-"+b,e=a(this.elements[b]).clone(),f=a(".mediumInsert",e),c=0;c<f.length;c++)g=a(f[c]),h=a(".mediumInsert-placeholder",g).children(),0===h.length?g.remove():(g.removeAttr("contenteditable"),a("img[draggable]",g).removeAttr("draggable"),g.hasClass("small")&&h.addClass("small"),a(".mediumInsert-buttons",g).remove(),h.unwrap());i=e.html().trim(),j[d]={value:i}}return j},a.fn.mediumInsert=function(b){return a.fn.mediumInsert.settings=a.extend(a.fn.mediumInsert.settings,b),this.each(function(){a("p",this).bind("dragover drop",function(a){return a.preventDefault(),!1}),a.fn.mediumInsert.insert.init(a(this)),a.fn.mediumInsert.settings.images===!0&&a.fn.mediumInsert.images.init(),a.fn.mediumInsert.settings.maps===!0&&a.fn.mediumInsert.maps.init()})},a.fn.mediumInsert.settings={imagesUploadScript:"upload.php",images:!0,maps:!1},a.fn.mediumInsert.insert={init:function(a){this.$el=a,this.setPlaceholders()},deselect:function(){document.getSelection().removeAllRanges()},setPlaceholders:function(){var b=this,c=a.fn.mediumInsert.insert.$el,d="",e='<a class="mediumInsert-action action-images-add">Image</a>',f='<a class="mediumInsert-action action-maps-add">Map</a>';a.fn.mediumInsert.settings.images===!0&&a.fn.mediumInsert.settings.maps===!0?d='<a class="mediumInsert-buttonsShow">Insert</a><ul class="mediumInsert-buttonsOptions"><li>'+e+"</li><li>"+f+"</li></ul>":a.fn.mediumInsert.settings.images===!0?d=e:a.fn.mediumInsert.settings.maps===!0&&(d=f),""!==d&&(d='<div class="mediumInsert" contenteditable="false"><div class="mediumInsert-buttons"><div class="mediumInsert-buttonsIcon">&rarr;</div>'+d+'</div><div class="mediumInsert-placeholder"></div></div>',c.is(":empty")&&c.html("<p><br></p>"),c.keyup(function(){var b=0;c.children("p").each(function(){a(this).next().hasClass("mediumInsert")===!1&&(a(this).after(d),a(this).next(".mediumInsert").attr("id","mediumInsert-"+b)),b++})}).keyup(),c.on("selectstart",".mediumInsert",function(a){return a.preventDefault(),!1}),c.on("blur",function(){var b,c=a(this).clone();c.find(".mediumInsert").remove(),b=c.html().replace(/^\s+|\s+$/g,""),(""===b||"<p><br></p>"===b)&&a(this).addClass("medium-editor-placeholder")}),c.on("click",".mediumInsert-buttons a.mediumInsert-buttonsShow",function(){var c=a(this).siblings(".mediumInsert-buttonsOptions"),d=a(this).parent().siblings(".mediumInsert-placeholder");a(this).hasClass("active")?(a(this).removeClass("active"),c.hide(),a("a",c).show()):(a(this).addClass("active"),c.show(),a("a",c).each(function(){var b=a(this).attr("class").split("action-")[1],e=b.split("-")[0];a(".mediumInsert-"+e,d).length>0&&a("a:not(.action-"+b+")",c).hide()})),b.deselect()}),c.on("mouseleave",".mediumInsert",function(){a("a.mediumInsert-buttonsShow",this).removeClass("active"),a(".mediumInsert-buttonsOptions",this).hide()}),c.on("click",".mediumInsert-buttons .mediumInsert-action",function(){var b=a(this).attr("class").split("action-")[1].split("-"),c=a(this).parents(".mediumInsert-buttons").siblings(".mediumInsert-placeholder");a.fn.mediumInsert[b[0]]&&a.fn.mediumInsert[b[0]][b[1]]&&a.fn.mediumInsert[b[0]][b[1]](c),a(this).parents(".mediumInsert").mouseleave()}))}}}(jQuery),function(a){a.fn.mediumInsert.images={init:function(){this.$el=a.fn.mediumInsert.insert.$el,this.options=a.extend(this.default,a.fn.mediumInsert.settings.imagesPlugin),this.setImageEvents(),this.setDragAndDropEvents(),this.preparePreviousImages()},"default":{formatData:function(a){var b=new FormData;return b.append("file",a),b}},preparePreviousImages:function(){this.$el.find(".mediumInsert-images").each(function(){var b=a(this).parent();b.html('<div class="mediumInsert-placeholder" draggable="true">'+b.html()+"</div>")})},add:function(b){var c,d,e=this;return c=a('<input type="file">').click(),c.change(function(){d=this.files,e.uploadFiles(b,d)}),a.fn.mediumInsert.insert.deselect(),c},updateProgressBar:function(b){var c,d=a(".progress:first",this.$el);b.lengthComputable&&(c=b.loaded/b.total*100|0,d.attr("value",c),d.html(c))},uploadCompleted:function(b){var c,d=a(".progress:first",this.$el);d.attr("value",100),d.html(100),d.before('<div class="mediumInsert-images"><img src="'+b.responseText+'" draggable="true" alt=""></div>'),c=d.siblings("img"),d.remove(),c.load(function(){c.parent().mouseleave().mouseenter()})},uploadFiles:function(b,c){for(var d={"image/png":!0,"image/jpeg":!0,"image/gif":!0},e=this,f=function(){var a=new XMLHttpRequest;return a.upload.onprogress=e.updateProgressBar,a},g=0;g<c.length;g++){var h=c[g];d[h.type]===!0&&(b.append('<progress class="progress" min="0" max="100" value="0">0</progress>'),a.ajax({type:"post",url:a.fn.mediumInsert.settings.imagesUploadScript,xhr:f,cache:!1,contentType:!1,complete:this.uploadCompleted,processData:!1,data:this.options.formatData(h)}))}},setImageEvents:function(){this.$el.on("mouseenter",".mediumInsert-images",function(){var b,c,d=a("img",this);d.length>0&&(a(this).append('<a class="mediumInsert-imageRemove"></a>'),a(this).append(a(this).parent().parent().hasClass("small")?'<a class="mediumInsert-imageResizeBigger"></a>':'<a class="mediumInsert-imageResizeSmaller"></a>'),b=d.position().top+parseInt(d.css("margin-top"),10),c=d.position().left+d.width()-30,a(".mediumInsert-imageRemove",this).css({right:"auto",top:b,left:c}),a(".mediumInsert-imageResizeBigger, .mediumInsert-imageResizeSmaller",this).css({right:"auto",top:b,left:c-31}))}),this.$el.on("mouseleave",".mediumInsert-images",function(){a(".mediumInsert-imageRemove, .mediumInsert-imageResizeSmaller, .mediumInsert-imageResizeBigger",this).remove()}),this.$el.on("click",".mediumInsert-imageResizeSmaller",function(){a(this).parent().parent().parent().addClass("small"),a(this).parent().mouseleave().mouseleave(),a.fn.mediumInsert.insert.deselect()}),this.$el.on("click",".mediumInsert-imageResizeBigger",function(){a(this).parent().parent().parent().removeClass("small"),a(this).parent().mouseleave().mouseleave(),a.fn.mediumInsert.insert.deselect()}),this.$el.on("click",".mediumInsert-imageRemove",function(){0===a(this).parent().siblings().length&&a(this).parent().parent().parent().removeClass("small"),a(this).parent().remove(),a.fn.mediumInsert.insert.deselect()})},setDragAndDropEvents:function(){var b,c,d=this,e=!1,f=!1;a(document).on("dragover","body",function(){a(this).addClass("hover")}),a(document).on("dragend","body",function(){a(this).removeClass("hover")}),this.$el.on("dragover",".mediumInsert",function(){a(this).addClass("hover"),a(this).attr("contenteditable",!0)}),this.$el.on("dragleave",".mediumInsert",function(){a(this).removeClass("hover"),a(this).attr("contenteditable",!1)}),this.$el.on("dragstart",".mediumInsert .mediumInsert-images img",function(){b=a(this).parent().index(),c=a(this).parent().parent().parent().attr("id")}),this.$el.on("dragend",".mediumInsert .mediumInsert-images img",function(b){e===!0&&(0===a(b.originalEvent.target.parentNode).siblings().length&&a(b.originalEvent.target.parentNode).parent().parent().removeClass("small"),a(b.originalEvent.target.parentNode).mouseleave(),a(b.originalEvent.target.parentNode).remove(),e=!1,f=!1)}),this.$el.on("dragover",".mediumInsert .mediumInsert-images img",function(a){a.preventDefault()}),this.$el.on("drop",".mediumInsert .mediumInsert-images img",function(){var d,e,g;return c!==a(this).parent().parent().parent().attr("id")?(f=!1,void(b=c=null)):(d=parseInt(b,10),e=a(this).parent().parent().find(".mediumInsert-images:nth-child("+(d+1)+")"),g=a(this).parent().index(),g>d?e.insertAfter(a(this).parent()):d>g&&e.insertBefore(a(this).parent()),e.mouseleave(),f=!0,void(b=null))}),this.$el.on("drop",".mediumInsert",function(b){var c;b.preventDefault(),a(this).removeClass("hover"),a("body").removeClass("hover"),a(this).attr("contenteditable",!1),c=b.originalEvent.dataTransfer.files,c.length>0?d.uploadFiles(a(".mediumInsert-placeholder",this),c):f===!0?f=!1:(a(".mediumInsert-placeholder",this).append('<div class="mediumInsert-images">'+b.originalEvent.dataTransfer.getData("text/html")+"</div>"),a("meta",this).remove(),e=!0)})}}}(jQuery),function(a){{var b=Backbone.View.extend({el:".splash.dropspot",input:"input.dropspot",events:{"hover .drag-over":"overlay"},settings:{url:"/upload",maxfilesize:3},initialize:function(){_.bindAll(this,"finished"),_.extend(this.settings,{uploadFinished:this.finished}),this.render()},render:function(){a(this.el).filedrop(this.settings)},finished:function(b,c,d){this.$el.css("background-image","url("+d+")"),a(this.input).val(d)}});new b}}(jQuery),function(){{var a=Backbone.Model.extend({idAttribute:"_id",urlRoot:"/post",validate:function(a){console.log("validating "+JSON.stringify(a))},initialize:function(){this.fetch()}}),b=Backbone.View.extend({el:"form",events:{submit:"add","click a.delete":"remove"},initialize:function(){_.bindAll(this,"add","remove")},add:function(a){a.preventDefault();var b=this.$el.serializeJSON();this.model.save(b,{wait:!0})},remove:function(a){a.preventDefault(),this.model.destroy()}}),c=new a({_id:postdata._id});new b({model:c})}}(jQuery),function(a){{var b=Backbone.View.extend({el:".editable",template:'<textarea id="textarea-<%= id %>" name="<%= id %>" class="hidden mirror"><%= content %></textarea>',events:{input:"mirror"},initialize:function(){_.bindAll(this,"textarea"),this.editor=new MediumEditor(this.$el.selector),this.$el.mediumInsert({editor:this.editor,imagesUploadScript:"/upload"}),this.render()},render:function(){_.map(this.$el,this.textarea)},textarea:function(a,b){var c=_.template(this.template,{id:this.$el.get(b).id,content:this.$el.eq(b).html()});this.$el.eq(b).after(c)
},mirror:function(b){var c=this.editor.serialize()[b.target.id].value;a("#textarea-"+b.target.id).val(c)}});new b}}(jQuery);